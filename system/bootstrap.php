<?php

/*
 * ---------------------------------------------------------------------------
 *  Define a custom include path
 * ---------------------------------------------------------------------------
 */

set_include_path('./' . PATH_SEPARATOR . SITE_DIR . PATH_SEPARATOR . SYSTEM_DIR);

/*
 * ---------------------------------------------------------------------------
 * Core file inclusion
 * ---------------------------------------------------------------------------
 */

require 'common/functions.php';

require 'common/constants.php';

require 'common/exceptions.php';

/*
 * ---------------------------------------------------------------------------
 * Set custom error reporting
 * ---------------------------------------------------------------------------
 */

error_reporting( DEVEL ? E_ALL : E_ERROR | E_PARSE );

/*
 * ---------------------------------------------------------------------------
 * Boot
 * ---------------------------------------------------------------------------
 */

unset_globals();

/*
 * ---------------------------------------------------------------------------
 * Class loader
 * ---------------------------------------------------------------------------
 */

function __autoload($class) {
	include_module('libraries', $class);
}

/*
 * ---------------------------------------------------------------------------
 *  Define a custom error handler to render better PHP errors
 * ---------------------------------------------------------------------------
 */

set_error_handler(array('Error','handler'));
set_exception_handler(array('Error','exception'));

/*
 * ---------------------------------------------------------------------------
 * Register shutdown hook as first shutdown function
 * ---------------------------------------------------------------------------
 */

register_shutdown_function('Hook::call', HOOK_SHUTDOWN);

/*
 * ---------------------------------------------------------------------------
 * Load modules/libraries/helpers
 * ---------------------------------------------------------------------------
 */

Load::auto();

/*
 * ---------------------------------------------------------------------------
 * Boot hook
 * ---------------------------------------------------------------------------
 */

Hook::call(HOOK_BOOT);
